<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>æ­Œæ›²æœç´¢å™¨ï¼ˆSupabaseç‰ˆï¼‰</title>
<style>
  body{font-family:system-ui,Arial;background:#f8fafc;margin:0;padding:20px;}
  .wrap{max-width:800px;margin:0 auto;background:#fff;padding:24px;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,0.08);}
  h1{font-size:22px;margin-bottom:16px;}
  input{width:100%;padding:10px;border:1px solid #ccc;border-radius:8px;font-size:16px;}
  .result{margin-top:20px;}
  .song{padding:12px 0;border-bottom:1px solid #eee;}
  .title{font-weight:bold;font-size:16px;color:#333;}
  .artist{color:#666;font-size:14px;}
  .lyrics{margin-top:6px;color:#444;white-space:pre-wrap;}
  .highlight{background:yellow;font-weight:bold;}
  .none{color:#777;margin-top:10px;}
</style>
</head>
<body>
<div class="wrap">
  <h1>ğŸµ æ­Œæ›²æœç´¢ï¼ˆæ¥è‡ª Supabaseï¼‰</h1>
  <input type="text" id="searchInput" placeholder="è¾“å…¥æ­Œåã€åŸå”±æˆ–æ­Œè¯å…³é”®è¯..." />
  <div id="result" class="result">åŠ è½½ä¸­â€¦</div>
</div>

<!-- ä¾èµ– -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
<script>
  // âœ… Supabase é¡¹ç›®é…ç½®ï¼ˆä½¿ç”¨ä½ çš„ï¼‰
  const SUPABASE_URL = "https://jstizcjnfujlffdkdnov.supabase.co";
  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpzdGl6Y2puZnVqbGZmZGtkbm92Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI0MTIxNTMsImV4cCI6MjA3Nzk4ODE1M30.xTOGlMQXmOTqXApPXI1TK4XZ0fkFjzGnP0LZDMYFZ24";
  const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  const input = document.getElementById('searchInput');
  const resultDiv = document.getElementById('result');

  async function searchSongs(keyword) {
    resultDiv.innerHTML = '';
    if (!keyword.trim()) return;

    resultDiv.textContent = 'æœç´¢ä¸­...';
    // ğŸ” æ¨¡ç³ŠåŒ¹é… title / artist / lyrics
    const { data, error } = await supabase
      .from('songs')
      .select('*')
      .or(`title.ilike.%${keyword}%,artist.ilike.%${keyword}%,lyrics.ilike.%${keyword}%`)
      .limit(100);

    if (error) {
      console.error(error);
      resultDiv.textContent = 'æœç´¢å¤±è´¥ï¼š' + error.message;
      return;
    }

    renderResults(data, keyword);
  }

  function renderResults(rows, keyword) {
    resultDiv.innerHTML = '';
    if (!rows || rows.length === 0) {
      resultDiv.innerHTML = '<p class="none">æ²¡æœ‰æ‰¾åˆ°åŒ¹é…ç»“æœã€‚</p>';
      return;
    }

    rows.forEach(r => {
      const div = document.createElement('div');
      div.className = 'song';
      const highlight = (text) =>
        text ? text.replaceAll(keyword, `<span class="highlight">${keyword}</span>`) : '';
      div.innerHTML = `
        <div class="title">${highlight(r.title || '')}</div>
        <div class="artist">${highlight(r.artist || '')}ï¼ˆ${r.year || 'æœªçŸ¥å¹´ä»½'}ï¼‰</div>
        <div class="lyrics">${highlight((r.lyrics || '').slice(0, 200))}${r.lyrics && r.lyrics.length > 200 ? '...' : ''}</div>
      `;
      resultDiv.appendChild(div);
    });
  }

  input.addEventListener('input', e => {
    const keyword = e.target.value.trim();
    if (keyword.length >= 1) {
      searchSongs(keyword);
    } else {
      resultDiv.innerHTML = '';
    }
  });

  // é¦–æ¬¡åŠ è½½æç¤º
  resultDiv.textContent = 'è¯·è¾“å…¥å…³é”®è¯å¼€å§‹æœç´¢ã€‚';
</script>
</body>
</html>
