<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>æ­Œè¯æœç´¢</title>
<style>
:root{--main:#6366f1;--bg:#f7f9fc;--card:#fff;--line:#e5e7eb;--text:#111;--muted:#6b7280;}
body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial;background:var(--bg);display:flex;justify-content:center;padding:40px 20px;}
.card{width:100%;max-width:680px;background:var(--card);border-radius:12px;box-shadow:0 8px 24px rgba(0,0,0,.06);padding:32px;}
h1{font-size:26px;margin:0 0 24px;font-weight:600;color:var(--text);}
input[type=text]{width:100%;padding:12px 14px;border:1px solid var(--line);border-radius:8px;font-size:16px;}
.result{margin-top:24px;max-height:60vh;overflow:auto;}
.item{padding:18px 0;border-bottom:1px solid var(--line);}
.item .title{font-size:14px;color:var(--muted);margin-bottom:4px;}
.item .lyrics{font-size:18px;color:var(--text);white-space:pre-wrap;line-height:1.5;}
.highlight{background:#fef08a;font-weight:600;}
.none{color:var(--muted);margin-top:10px;}
</style>
</head>
<body>
<div class="card">
  <h1>ğŸ” æ­Œè¯æœç´¢</h1>
  <input id="searchInput" type="text" placeholder="è¾“å…¥æ­Œè¯å…³é”®è¯â€¦" />
  <div id="result" class="result">è¯·è¾“å…¥å…³é”®è¯å¼€å§‹æœç´¢ã€‚</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
<script>
/* ====== é…ç½® ====== */
const SUPABASE_URL  = 'https://jstizcjnfujlffdkdnov.supabase.co';
const SUPABASE_ANON = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpzdGl6Y2puZnVqbGZmZGtkbm92Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI0MTIxNTMsImV4cCI6MjA3Nzk4ODE1M30.xTOGlMQXmOTqXApPXI1TK4XZ0fkFjzGnP0LZDMYFZ24';
const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON);

/* ====== æœç´¢ ====== */
const input = document.getElementById('searchInput');
const result = document.getElementById('result');

async function searchLyrics(kw){
  if(!kw.trim()) return result.textContent='è¯·è¾“å…¥å…³é”®è¯å¼€å§‹æœç´¢ã€‚';
  result.textContent='æœç´¢ä¸­â€¦';
  const {data,error} = await sb.from('songs').select('id,title,lyrics').ilike('lyrics',`%${kw}%`).limit(100);
  if(error) return result.textContent='æœç´¢å¤±è´¥ï¼š'+error.message;
  render(data,kw);
}
function render(rows,kw){
  if(!rows.length) return result.innerHTML='<p class="none">æœªæ‰¾åˆ°ç›¸å…³æ­Œè¯ã€‚</p>';
  result.innerHTML='';
  rows.forEach(r=>{
    const div=document.createElement('div');div.className='item';
    div.innerHTML=`
      <div class="title">${esc(r.title||'æœªå‘½å')}</div>
      <div class="lyrics">${highlight(esc(r.lyrics||''),kw)}</div>`;
    result.appendChild(div);
  });
}
function esc(str){return str.replace(/[&<>"']/g,s=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[s]));}
function highlight(txt,kw){return txt.replaceAll(kw,`<span class="highlight">${kw}</span>`);}
input.addEventListener('input',e=>searchLyrics(e.target.value.trim()));
</script>
</body>
</html>
